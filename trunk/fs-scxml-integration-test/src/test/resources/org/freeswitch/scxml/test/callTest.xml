<?xml version="1.0" encoding="UTF-8"?>
<sc:scxml  xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
           xmlns:sc="http://www.w3.org/2005/07/scxml"
           xmlns:fs="http://www.freeswitch.org"
           xsi:schemaLocation="http://www.w3.org/2005/07/scxml 
           scxml.xsd
           http://www.freeswitch.org 
           fs-core.xsd"
           initialstate="intro-main">
    
    <sc:datamodel>
        <sc:data name="await" expr="0" />    
    </sc:datamodel>
    
    <sc:state id="intro-main">
        <sc:onentry>
            <fs:answer/>
        </sc:onentry>
        <sc:transition target="await">
            <fs:call value="'sofia/external/jocke@213.136.53.177:5050'" />
        </sc:transition>
    </sc:state>
    
    <sc:state id="await">
        <sc:onentry>
            <sc:log expr="'await'" />
            <sc:assign name="await" expr="await = await + 1" />
        </sc:onentry>
            
        <sc:transition target="await" cond="await lt 4" >
            <fs:gentone value="ring" repeat="10" />    
        </sc:transition>
           
        <sc:transition event="answer" target="exit" >
            <fs:say>'Far end answerd the call'</fs:say>    
        </sc:transition>
        
        <sc:transition event="hangup" target="exit" >
            <sc:assign name="await" expr="await = 5" />
            <sc:log expr="'hangup'" />
        </sc:transition>
        
    </sc:state>
    
    <sc:state id="exit" final="true">
        <sc:onentry>
            <fs:say>Bye</fs:say>
            <fs:hangup />
        </sc:onentry>                
    </sc:state>
</sc:scxml>
