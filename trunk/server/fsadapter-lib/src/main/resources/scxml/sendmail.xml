
<sc:scxml  xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
   xmlns:sc='http://www.w3.org/2005/07/scxml'
   xmlns:ms='http://telmi.se/MS'
   xsi:schemaLocation='
   http://www.w3.org/2005/07/scxml
   scxml.xsd
   http://telmi.se/MS
   telmims.xsd' initialstate="voicemail">

    <sc:datamodel>
    <sc:data name="template" expr="'missed-call.vm'" />
    <sc:data name="action"   expr="'SENDMAIL'" />
        <!--Sound Path -->
     <sc:data name="sp" expr="'/usr/local/freeswitch/sounds/voicemail/'" />
    </sc:datamodel>


    <sc:state id="voicemail">
        <sc:onentry>
           <ms:answer />
           <ms:playaudio value="sp + 'send-mail.wav'" />
           <ms:recordaudio
           beep="true"
           maxtime="100s"
           ms:termdigits="#"
           var="recording"/>
        </sc:onentry>

        <sc:transition event="hangup" target="send" />
        <sc:transition event="termdigit" target="send" />
        <sc:transition event="maxtime" target="send" />

    </sc:state>
    
    <sc:state id="send">
        <sc:transition target="exit">
         <sc:send targettype="'basichttp'"
                  target="'http://localhost:8080/test'"
                  namelist="template recording action" />
        </sc:transition>
    </sc:state>

    <sc:state id="exit" final="true">
        <sc:onentry>
            <ms:hangup/>
        </sc:onentry>
    </sc:state>
</sc:scxml>
