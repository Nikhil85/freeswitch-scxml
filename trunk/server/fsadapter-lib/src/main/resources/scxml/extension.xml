
<sc:scxml  xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
   xmlns:sc='http://www.w3.org/2005/07/scxml'
   xmlns:ms='http://telmi.se/MS'
   xsi:schemaLocation='
   http://www.w3.org/2005/07/scxml
   scxml.xsd
   http://telmi.se/MS
   telmims.xsd' initialstate="welcome">

    <sc:datamodel>
        <sc:data name="sp" expr="'/usr/local/freeswitch/sounds/extension/'" />
        <sc:data name="extensions" expr="3" />
        <sc:data name="choice" expr="'notset'" />
        <sc:data name="answer" expr="true" />
    </sc:datamodel>
    
    <sc:state id="welcome">
        <sc:onentry>
            <ms:answer ms:test="answer" />
            <sc:assign name="answer" expr="false" />
            <ms:menu
           ms:choicesexpr="'1-' + extensions"
           maxtime="30s"
           value="sp + 'main-menu.wav'" />
        </sc:onentry>

        <sc:transition event="match"   target="exit" >
            <sc:assign name="choice" expr="_eventdatamap.match" />
             <sc:log expr="choice" />
        </sc:transition>

        <sc:transition event="maxtime"  target="welcome" cond="count.maxtime lt 3" />
        <sc:transition event="maxtime"  target="exit" cond="count.maxtime == 3" />

        <sc:transition  event="nomatch" target="welcome" cond="count.nomatch lt 3" />
        <sc:transition  event="nomatch" target="exit" cond="count.nomatch == 3" />

    </sc:state>

    <sc:state id="exit" final="true">
        <sc:onentry>
            <ms:exit  namelist="choice" />
        </sc:onentry>
    </sc:state>
</sc:scxml>
